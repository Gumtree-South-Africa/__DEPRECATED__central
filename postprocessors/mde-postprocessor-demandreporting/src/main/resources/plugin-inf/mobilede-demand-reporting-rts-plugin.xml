<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="writingReportingClient" class="de.mobile.reporting.demand.client.internal.MongoDBWritingReportingClient"
          destroy-method="shutdown">
        <constructor-arg value="${reporting.mongodb.hosts}"/>
        <constructor-arg value="${reporting.mongodb.concurrency}"/>
    </bean>

    <bean id="gson" factory-method="createConfiguredGson" class="com.ecg.de.mobile.replyts.demand.GsonDemandConfig" />
       
    <bean id="httpClientConfig" class="com.ecg.de.mobile.replyts.demand.HttpClientProvider.Config"/>

    <bean id="httpClientProvider" class="com.ecg.de.mobile.replyts.demand.HttpClientProvider" destroy-method="shutdownClient">
        <constructor-arg ref="httpClientConfig"/>
    </bean>

    <bean id="httpClient" class="org.apache.http.client.HttpClient" factory-bean="httpClientProvider"
          factory-method="provideClient" >
    </bean>

    <bean id="behaviorTrackingConfig" class="com.ecg.de.mobile.replyts.demand.BehaviorTrackingHandler.Config"/>

    <bean id="behaviorTrackingHandler" class="com.ecg.de.mobile.replyts.demand.BehaviorTrackingHandler" destroy-method="flushOnExit">
        <constructor-arg ref="behaviorTrackingConfig"/>
        <constructor-arg>
            <bean class="com.ecg.de.mobile.replyts.demand.HttpEventPublisherFactory">
                <constructor-arg ref="behaviorTrackingConfig" />
                <constructor-arg ref="httpClient" />
                <constructor-arg ref="gson" />
            </bean>
        </constructor-arg>
    </bean>

    <bean class="com.ecg.de.mobile.replyts.demand.DemandReportingPostProcessor">
        <constructor-arg>
            <bean class="com.ecg.de.mobile.replyts.demand.DemandReportingHandlerFactory">
                <constructor-arg ref="writingReportingClient"/>
            </bean>
        </constructor-arg>
        <constructor-arg ref="behaviorTrackingHandler"/>
        <constructor-arg value="${mobilede.demand.reporting.plugin.order}"/>
    </bean>

</beans>