<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:p="http://www.springframework.org/schema/p" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="replyts2-blockedipfilter-plugin-datasource" class="com.ebay.au.gumtree.replyts.blockedip.BlockedIpFilterFactory">
        <constructor-arg index="0" ref="ipDataSource"/>
    </bean>

    <bean id="ipDataSource" class="com.zaxxer.hikari.HikariDataSource" destroy-method="close"
          p:jdbcUrl="${replyts2-blockedipfilter-plugin.dataSource.url}"
          p:username="${replyts2-blockedipfilter-plugin.username:belen}"
          p:password="${replyts2-blockedipfilter-plugin.password:}"
          p:maximumPoolSize="${replyts2-blockedipfilter-plugin.dataSource.pool.maxPoolSize:100}"
          p:minimumIdle="${replyts2-blockedipfilter-plugin.dataSource.pool.minIdle:5}"
          p:connectionTimeout="${replyts2-blockedipfilter-plugin.dataSource.borrowTimeout:2000}"
          p:poolName="${replyts2-blockedipfilter-plugin.dataSource.pool.name:}"
          p:dataSourceProperties-ref="dataSourceProperties"/>

    <bean id="dataSourceProperties" class="java.util.Properties">
        <constructor-arg>
            <props>
                <prop key="cachePrepStmts">${replyts2-blockedipfilter-plugin.dataSource.cachePrepStmts:true}</prop>
                <prop key="prepStmtCacheSize">${replyts2-blockedipfilter-plugin.dataSource.prepStmtCacheSize:250}</prop>
                <prop key="prepStmtCacheSqlLimit">${replyts2-blockedipfilter-plugin.dataSource.prepStmtCacheSqlLimit:2048}</prop>
                <prop key="useServerPrepStmts">${replyts2-blockedipfilter-plugin.dataSource.useServerPrepStmts:true}</prop>
                <prop key="socketTimeout">${replyts2-blockedipfilter-plugin.dataSource.socketTimeout:60000}</prop>
                <prop key="connectTimeout">${replyts2-blockedipfilter-plugin.dataSource.connectTimeout:30000}</prop>
            </props>
        </constructor-arg>
    </bean>

    <bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
        <property name="staticMethod" value="java.sql.DriverManager.setLoginTimeout"/>
        <property name="arguments" value="${replyts2-belenblockeduserfilter-plugin.dataSource.pool.loginTimeout:1}"/>
    </bean>

</beans>